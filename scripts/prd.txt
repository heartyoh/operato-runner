<context>
# Operato Runner â€“ Product Requirements Document (PRD)

# Overview  

Operato RunnerëŠ” ë‹¤ì–‘í•œ ì‹¤í–‰ í™˜ê²½ì—ì„œ Python ëª¨ë“ˆì„ ì•ˆì „í•˜ê³  ì¼ê´€ë˜ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê³ ìœ í•œ ì‹¤í–‰ í”Œë«í¼ì…ë‹ˆë‹¤. REST ë° gRPC ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì™¸ë¶€ ì‹œìŠ¤í…œì´ Python ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ì½”ë“œ ë¸”ë¡ì„ ë“±ë¡í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì‹¤í–‰ ê²°ê³¼ëŠ” êµ¬ì¡°í™”ëœ JSON í˜•íƒœë¡œ ë°˜í™˜ë©ë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì€ AI ì¤‘ì‹¬ì˜ ì›Œí¬í”Œë¡œìš°, ìë™í™” íŒŒì´í”„ë¼ì¸, ë™ì  ë¶„ì„ íƒœìŠ¤í¬ë¥¼ ìœ„í•œ \*\*ì‹¤í–‰ ê³„ì¸µ(Task Layer)\*\*ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, Operato í”Œë«í¼ì˜ **MCP(Model Context Protocol)** ê¸°ë°˜ ìë™í™” ì¸í”„ë¼ì˜ í•µì‹¬ êµ¬ì„± ìš”ì†Œë¡œ ìë¦¬ì¡ìŠµë‹ˆë‹¤.

**ëŒ€ìƒ ì‚¬ìš©ì:**

* AI/ML ì‹¤í—˜ ì‹¤í–‰ê¸° ë° LLM ê¸°ë°˜ ì½”ë“œ í‰ê°€ ì‹œìŠ¤í…œ
* ë¬¼ë¥˜, ì œì¡°, ìš´ì˜ ì‹œìŠ¤í…œì˜ ìë™ ë¶„ì„ íŠ¸ë¦¬ê±°
* Python ê¸°ë°˜ ê¸°ëŠ¥ì„ ì˜¨ë””ë§¨ë“œë¡œ ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” SaaS/í”Œë«í¼ ì„œë¹„ìŠ¤

**í•´ê²° ê³¼ì œ:**

* ë‹¤ì–‘í•œ í™˜ê²½ë³„ íŒŒì´ì¬ ì‹¤í–‰(venv, conda, docker ë“±)ì˜ í†µì¼ëœ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤ ë¶€ì¬
* Python ì½”ë“œë¥¼ ì™¸ë¶€ì—ì„œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ í•„ìš”
* ì‹¤í–‰ í™˜ê²½ ì¶©ëŒ, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶©ëŒ ë¬¸ì œ í•´ê²°

---

# Core Features  

### âœ… ëª¨ë“ˆ ì‹¤í–‰ ì—”ì§„

* ë‹¤ì–‘í•œ í™˜ê²½ë³„ ì‹¤í–‰ ì§€ì›: `inline`, `venv`, `conda`, `docker`
* ì‹¤í–‰ ë‹¨ìœ„: `handler(input: dict) -> output: dict` í˜•íƒœë¡œ í‘œì¤€í™”
* ì¤‘ìš”ì„±: ë³µì¡í•œ ì˜ì¡´ì„±ê³¼ í™˜ê²½ êµ¬ì„±ì„ ì„œë²„ê°€ ì¶”ìƒí™”í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ ë‹¨ìˆœí™”

### âœ… ë™ì  ëª¨ë“ˆ ë“±ë¡

* ì½”ë“œ/ìŠ¤í¬ë¦½íŠ¸ë¥¼ REST API ë˜ëŠ” gRPCë¥¼ í†µí•´ ì‹¤ì‹œê°„ ë“±ë¡
* ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ëª¨ë“ˆ ì‹ë³„ ë° ë²„ì „ ê´€ë¦¬ ê°€ëŠ¥
* ì¤‘ìš”ì„±: ìš´ì˜ ì¤‘ì¸ ì‹œìŠ¤í…œì—ì„œë„ ìœ ì—°í•˜ê²Œ ê¸°ëŠ¥ ì—…ë°ì´íŠ¸ ê°€ëŠ¥

### âœ… í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤

* REST API: `/run/{module}`, `/modules`
* gRPC: `Execute(ExecRequest) â†’ ExecResponse`
* ì¤‘ìš”ì„±: ë‹¤ì–‘í•œ ì‹œìŠ¤í…œ ì–¸ì–´/í™˜ê²½ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥

### âœ… ì‹¤í–‰ ê²°ê³¼ ì¶”ì 

* stdout, stderr, exit\_code, duration ë“±ì„ ê¸°ë¡
* ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì •ì±…, ì—ëŸ¬ ë©”ì‹œì§€ êµ¬ì¡°í™” í¬í•¨

### âœ… ìŠ¤ì¼€ì¤„ëŸ¬/AI ì—°ë™ ê°€ëŠ¥

* ì™¸ë¶€ scheduler-serviceì™€ ì—°ë™í•˜ì—¬ ì •ê¸° ì‹¤í–‰ ê°€ëŠ¥
* LLMì´ ìƒì„±í•œ ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥ (ì½”ë“œ â†’ ëª¨ë“ˆí™” â†’ ì‹¤í–‰ â†’ ê²°ê³¼ í”¼ë“œë°±)

# User Experience  

### ğŸ‘¤ User Personas

* **AI ì—”ì§€ë‹ˆì–´**: ë¶„ì„ ëª¨ë¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ APIë¡œ ê´€ë¦¬
* **ì‹œìŠ¤í…œ í†µí•©ì**: ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ íŠ¹ì • ê¸°ëŠ¥ì„ íŠ¸ë¦¬ê±°
* **ìš´ì˜ ê´€ë¦¬ì**: ìŠ¤ì¼€ì¤„ëœ ìë™í™” ê¸°ëŠ¥ ì‹¤í–‰ ë° ì‹¤íŒ¨ ì¶”ì 

### ğŸ” Key User Flows

1. ì‚¬ìš©ì ë˜ëŠ” LLMì´ ì½”ë“œ ì—…ë¡œë“œ (inline ë“±ë¡)
2. ë“±ë¡ëœ ëª¨ë“ˆì„ REST API ë˜ëŠ” gRPCë¡œ ì‹¤í–‰
3. ì‹¤í–‰ ê²°ê³¼ë¥¼ ì‘ë‹µë°›ì•„ ì²˜ë¦¬ (ë˜ëŠ” í”¼ë“œë°±)

### ğŸ¨ UI/UX Considerations (ì„ íƒì‚¬í•­)

* Operato í”Œë«í¼ì˜ ê´€ë¦¬ UIì—ì„œ ëª¨ë“ˆ ë“±ë¡/ì‹¤í–‰ ê¸°ë¡ í™•ì¸ ê°€ëŠ¥
* Swagger UI ê¸°ë°˜ OpenAPI ë¬¸ì„œ ìë™ ìƒì„±
</context>
<PRD>
# Technical Architecture  

### ğŸ§± System Components

* `ExecutorManager`: ì‹¤í–‰ ìš”ì²­ ë¼ìš°íŒ… ë° Executor ì„ íƒ
* `Executors/`: InlineExecutor, VenvExecutor, CondaExecutor, DockerExecutor
* `ModuleRegistry`: ë“±ë¡ëœ ëª¨ë“ˆ ê´€ë¦¬ (memory + YAML/DB)
* `api/rest.py`: FastAPI ê¸°ë°˜ REST ë¼ìš°í„°
* `api/grpc_server.py`: gRPC ì¸í„°í˜ì´ìŠ¤ ì²˜ë¦¬

### ğŸ§© Data Models

* Module: name, env, path/code, created\_at, version, tags
* ExecRequest: module, input\_json
* ExecResult: result\_json, exit\_code, stderr, duration

### ğŸŒ APIs and Integrations

* REST (FastAPI), gRPC (grpcio, protobuf)
* Docker SDK, subprocess, conda CLI ì‚¬ìš©
* í–¥í›„ Kafka, Redis pub/sub ì—°ë™ ê³ ë ¤

### â˜ï¸ Infrastructure Requirements

* Python 3.10+, Linux ê¸°ë°˜ ì„œë²„ ë˜ëŠ” ì»¨í…Œì´ë„ˆ í™˜ê²½
* Docker daemon ì ‘ê·¼ í•„ìš” (docker executor ì‚¬ìš© ì‹œ)
* PostgreSQL or SQLite (ì„ íƒ)
* Redis/Kafka (ì„ íƒ)

---

# Development Roadmap  

### ğŸ”¹ Phase 1: MVP

* inline, venv executor êµ¬í˜„
* FastAPI ê¸°ë°˜ REST `/run/{module}` êµ¬í˜„
* gRPC ê¸°ë³¸ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
* `modules.yaml` ê¸°ë°˜ ì •ì  ëª¨ë“ˆ ë¡œë”©
* ë¡œê·¸ ì¶œë ¥ ë° stdout/stderr ë°˜í™˜ ì²˜ë¦¬

### ğŸ”¹ Phase 2: ë™ì  ë“±ë¡ + í™•ì¥ ì‹¤í–‰ê¸°

* REST API ê¸°ë°˜ ë™ì  ëª¨ë“ˆ ë“±ë¡/ì¡°íšŒ/ì‚­ì œ
* docker, conda executor ì¶”ê°€ êµ¬í˜„
* ModuleRegistryì— in-memory + reload ê¸°ëŠ¥ êµ¬í˜„

### ğŸ”¹ Phase 3: ì•ˆì •í™” ë° í†µí•©

* ëª¨ë“ˆ ì‹¤í–‰ ì´ë ¥ ì €ì¥ (íŒŒì¼/DB)
* ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì •ì±… + ìƒíƒœ ê´€ë¦¬
* WASM/WASI executor ì„¤ê³„ ì°©ìˆ˜
* ì¸ì¦ í—¤ë”(JWT ë˜ëŠ” API Key) ë„ì…

### ğŸ”¹ Phase 4: ì—°ë™ ë° ë°°í¬

* scheduler-service ì—°ë™ í…ŒìŠ¤íŠ¸
* Helm chart ì‘ì„± + Kubernetes ë°°í¬ êµ¬ì¡°í™”
* log server ë˜ëŠ” Grafana/Prometheus ì—°ë™

---

# Logical Dependency Chain

1. Executor ì¸í„°í˜ì´ìŠ¤ ì •ì˜ + ê¸°ë³¸ executor êµ¬í˜„ (inline, venv)
2. `ModuleRegistry` â†’ module ê´€ë¦¬ êµ¬ì¡° í™•ë¦½
3. REST `/run`, gRPC `Execute` â†’ ê¸°ë³¸ ì‹¤í–‰ íë¦„ í™•ì¸
4. modules.yaml ë˜ëŠ” DB ê¸°ë°˜ ì´ˆê¸° ëª¨ë“ˆ ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„
5. ë™ì  ë“±ë¡ API (`/modules`) â†’ CRUD ì™„ì„±
6. í™•ì¥ ì‹¤í–‰ê¸° (docker, conda)
7. ìŠ¤ì¼€ì¼ ì•„ì›ƒ ê³ ë ¤: queue ì—°ë™, ì»¨í…Œì´ë„ˆ í’€
8. ì¸ì¦ ë° ë³´ì•ˆ ì²˜ë¦¬ â†’ ì‹¤ì„œë¹„ìŠ¤ ëŒ€ì‘

---

# Risks and Mitigations  

| ìœ„í—˜ìš”ì†Œ       | ì„¤ëª…                             | ëŒ€ì‘ì „ëµ                                 |
| ---------- | ------------------------------ | ------------------------------------ |
| í™˜ê²½ ì¶©ëŒ      | venv, conda, docker ê°„ ì‹¤í–‰ ê²½ë¡œ ì¶©ëŒ | executor ë³„ resource ì œí•œ ë° sandbox ì ìš©  |
| inline ë³´ì•ˆ  | ì‚¬ìš©ìê°€ ì§ì ‘ ì½”ë“œë¥¼ ë“±ë¡í•˜ëŠ” êµ¬ì¡°            | `ast` ê²€ì‚¬, `RestrictedPython` ì ìš© ê³ ë ¤   |
| ì¬ì‹œì‘ì‹œ ìƒíƒœ ì†ì‹¤ | ë“±ë¡ëœ ëª¨ë“ˆ ì •ë³´ ì†ì‹¤                   | `modules.yaml` ë°±ì—…, DB ë˜ëŠ” Redis ìºì‹± ì ìš© |
| ì‹¤í–‰ ì§€ì—°      | docker executorëŠ” cold start ëŠë¦¼ | ì»¨í…Œì´ë„ˆ í’€ ë˜ëŠ” ì‚¬ì „ warming êµ¬ì¡° ê³ ë ¤           |
| ìì› ê³ ê°ˆ      | ë‹¤ì¤‘ ì‹¤í–‰ ìš”ì²­ ì‹œ CPU/MEM ê³ ê°ˆ          | rate limit, ì‹¤í–‰í ë„ì…, scaling ì •ì±… ì ìš©    |

---

# Appendix  

### ì°¸ê³  ìë£Œ

* FastAPI: [https://fastapi.tiangolo.com](https://fastapi.tiangolo.com)
* grpcio: [https://grpc.io/docs/languages/python/](https://grpc.io/docs/languages/python/)
* PyExec íŒ¨í„´ ì‚¬ë¡€: OpenAI Codex-Sandbox, Replit, BentoML

### Protobuf ì˜ˆì‹œ

```proto
syntax = "proto3";
service Executor {
  rpc Execute(ExecRequest) returns (ExecResponse);
}
message ExecRequest {
  string module = 1;
  string json_input = 2;
}
message ExecResponse {
  string result = 1;
  int32 exit_code = 2;
  string stderr = 3;
}
```
</PRD>